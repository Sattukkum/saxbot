# Docker Setup –¥–ª—è SaxBot

## –ß—Ç–æ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### 1. üì¶ Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`docker-compose.yml`)

- **–°–µ—Ä–≤–∏—Å Redis**: 
  - –û–±—Ä–∞–∑: `redis:7-alpine`
  - –ü–æ—Ä—Ç: 6379
  - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
  - Health check
  - –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ `redis.conf`

- **–°–µ—Ä–≤–∏—Å SaxBot**:
  - –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Dockerfile
  - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
  - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Redis (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–µ–≥–æ)
  - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å

### 2. üê≥ Dockerfile –¥–ª—è Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **Multi-stage build**:
  - Builder stage: –∫–æ–º–ø–∏–ª—è—Ü–∏—è Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - Final stage: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Alpine –æ–±—Ä–∞–∑
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `saxbot`
- **Health check**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ CGO

### 3. ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **`redis.conf`**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis –¥–ª—è Docker (bind 0.0.0.0, dir /data)
- **`redis.local.conf`**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (bind 127.0.0.1, dir ./redis_data)
- **`.dockerignore`**: –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker build
- **`env.example`**: –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 4. üõ†Ô∏è Makefile –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º:
- `make help` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `make docker-up` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker
- `make docker-logs-bot` - –ª–æ–≥–∏ –±–æ—Ç–∞
- `make redis-local` - –∑–∞–ø—É—Å—Ç–∏—Ç—å Redis –ª–æ–∫–∞–ª—å–Ω–æ
- `make deploy` - –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π

### 5. üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ Docker –≤ README.md
- –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### main.go
```go
// –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Redis
redisHost := os.Getenv("REDIS_HOST")
if redisHost == "" {
    redisHost = "localhost"
}
redisPort := os.Getenv("REDIS_PORT")
if redisPort == "" {
    redisPort = "6379"
}
redisAddr := redisHost + ":" + redisPort
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker:
```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env, –¥–æ–±–∞–≤–∏–≤ BOT_TOKEN

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f saxbot
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make dev-setup

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis
make redis-local

# 3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
export BOT_TOKEN=your_token
make run
```

## Volumes –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

- **`redis_data`** - Docker volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Redis
- **`./logs`** - –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)
- **`./redis_data/`** - –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Redis –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## –°–µ—Ç—å

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–µ—Ç–∏ `saxbot-network`. –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Redis –ø–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞ `redis:6379`.

## Health Checks

- **Redis**: `redis-cli ping`
- **SaxBot**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ `pgrep saxbot`

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤.
